# 学习统计功能使用说明

## 概述

train-supervisor-bundle 现在支持培训组织者、各级应急管理部门系统管理员通过后台管理界面，按照时间、年龄、机构、区域等条件，查询和统计报名学习人数、已完成学习人数、在线学习人数等信息。

## 功能特性

### 核心统计指标

- 报名学习人数统计
- 已完成学习人数统计
- 在线学习人数统计
- 学习完成率分析

### 多维度查询条件

- **时间条件**: 按日期范围、特定日期查询
- **机构条件**: 按单个或多个培训机构查询
- **区域条件**: 按省份、城市、区域查询
- **年龄条件**: 按年龄段、年龄范围查询
- **其他条件**: 课程类型、学习状态、用户类型等

### 数据展示方式

- 实时统计数据
- 趋势分析图表
- 分组统计报表
- 数据导出功能

## 后台管理界面使用

### 访问学习统计功能

1. **登录管理后台**
   - 使用管理员账号登录系统
   - 确保账号具有学习统计查询权限

2. **进入学习统计模块**
   - 在左侧菜单中找到"学习统计"部分
   - 包含以下功能菜单：
     - **学习概览**: 查看总体统计数据和机构排名
     - **实时统计**: 查看实时数据和今日对比
     - **趋势分析**: 查看数据趋势图表
     - **统计报告**: 生成详细统计报告

### 主要功能页面

#### 1. 学习概览页面 (`/admin/learning-statistics`)

**主要功能:**

- 显示总体统计数据（报名、完成、在线、机构数量）
- 机构学习排名（前10名）
- 区域分布统计
- 学习趋势图表（最近30天）

**使用过滤条件:**

```html
<!-- 时间范围选择 -->
开始日期: [2024-01-01]
结束日期: [2024-12-31]

<!-- 机构选择 -->
机构: [下拉选择或输入机构名称]

<!-- 查询和重置按钮 -->
[查询] [重置]
```

**数据展示:**

- **统计卡片**: 显示核心指标和增长率
- **机构排名表**: 包含排名、机构名称、报名人数、完成人数、完成率
- **区域分布**: 各区域的学习情况对比
- **趋势图表**: 使用Chart.js显示报名和完成趋势

#### 2. 实时统计页面 (`/admin/learning-statistics/realtime`)

**主要功能:**

- 今日与昨日数据对比
- 实时在线学习人数
- 数据变化率分析
- 自动刷新功能

**实时数据展示:**

- **今日数据**: 今日报名、今日完成
- **昨日对比**: 昨日报名、昨日完成
- **变化率**: 报名变化和完成变化的绝对值和百分比
- **当前状态**: 在线人数、完成率、活跃机构数

**控制功能:**

```html
[刷新数据] [自动刷新] [返回概览]
```

#### 3. 趋势分析页面 (`/admin/learning-statistics/trends`)

**主要功能:**

- 按日、周、月查看数据趋势
- 多维度趋势对比
- 图表化展示

**查询选项:**

- 时间周期: 日、周、月
- 数据类型: 报名、完成、在线
- 对比维度: 机构、区域

#### 4. 统计报告页面 (`/admin/learning-statistics/reports`)

**主要功能:**

- 综合统计报告生成
- 机构详细统计
- 区域和年龄段分析
- 关键指标评估和改进建议

**报告设置:**

```html
报告类型: [综合报告|机构报告|区域报告|趋势分析报告]
时间范围: [最近一周|最近一月|最近一季度|最近一年|自定义]
导出格式: [PDF|Excel|CSV]

[生成报告] [导出]
```

**报告内容:**

- **概览数据**: 总报名、完成率、在线人数、活跃机构
- **机构排名**: 详细的机构统计表格，包含综合评分
- **区域分布**: 各区域的学习情况
- **年龄段分析**: 不同年龄段的学习表现
- **关键指标分析**: 自动生成评估结果和改进建议

### 查询过滤功能

所有统计页面都支持以下过滤条件：

#### 时间过滤

- **开始日期**: 选择查询的起始日期
- **结束日期**: 选择查询的结束日期
- **快捷选择**: 最近7天、最近30天、本月、上月等

#### 机构过滤

- **单机构查询**: 选择特定机构
- **多机构查询**: 支持多选机构进行对比
- **机构类型**: 按机构类别筛选

#### 区域过滤

- **省份**: 按省份筛选
- **城市**: 按城市筛选
- **区域**: 按大区（华北、华东等）筛选

#### 其他过滤

- **年龄段**: 18-25岁、26-35岁等
- **课程类型**: 安全培训、技能培训等
- **学习状态**: 进行中、已完成、未开始

### 数据导出功能

#### 支持的导出格式

1. **CSV格式**: 适合Excel打开和数据分析
2. **Excel格式**: 包含格式化的表格和图表
3. **PDF格式**: 适合打印和分享的报告格式

#### 导出操作

```html
<!-- 在报告页面 -->
导出格式: [PDF ▼]
[导出] 按钮

<!-- 或使用右键菜单 -->
右键点击表格 -> 导出数据
```

#### 导出限制

- **CSV导出**: 最多10万条记录
- **Excel导出**: 最多5万条记录  
- **PDF导出**: 最多1万条记录

### 权限控制

不同角色的用户有不同的查询权限：

#### 培训组织者

- ✅ 只能查询自己机构的学习数据
- ✅ 可以查看机构内各年龄段、课程类型的统计
- ✅ 可以导出本机构的数据
- ❌ 不能查看其他机构的详细数据

#### 区域管理员

- ✅ 可以查询管辖区域内所有机构的数据
- ✅ 可以进行跨机构的统计对比
- ✅ 可以查看区域内的趋势分析
- ❌ 不能查看其他区域的数据

#### 系统管理员

- ✅ 可以查询所有数据
- ✅ 无查询限制
- ✅ 可以执行所有统计和导出操作
- ✅ 可以管理用户权限

### 数据更新频率

- **实时数据**: 每分钟更新一次
- **日统计数据**: 每小时更新一次
- **趋势分析数据**: 每日凌晨更新
- **报告数据**: 按需生成

### 使用技巧

#### 1. 高效查询

- **合理设置时间范围**: 避免查询过长时间段的数据
- **使用具体条件**: 添加机构、区域等过滤条件减少数据量
- **保存常用查询**: 将常用的查询条件加入书签

#### 2. 数据分析

- **对比分析**: 使用多个时间段或机构进行对比
- **趋势观察**: 关注数据的变化趋势而不仅仅是绝对数值
- **异常识别**: 留意完成率异常低或作弊率异常高的机构

#### 3. 报告使用

- **定期生成**: 建议每周或每月生成综合报告
- **分享传播**: 将PDF报告分享给相关人员
- **存档管理**: 保存历史报告用于长期趋势分析

### 常见问题

#### 1. 数据不准确或缺失

**问题**: 显示的统计数据与实际情况不符
**解决方案**:

- 检查查询的时间范围是否正确
- 确认权限范围是否包含相关数据
- 联系系统管理员检查数据同步状态

#### 2. 页面加载缓慢

**问题**: 统计页面打开很慢或查询时间长
**解决方案**:

- 缩小查询时间范围
- 减少查询条件的复杂度
- 选择非高峰时段进行查询

#### 3. 导出失败

**问题**: 点击导出按钮没有反应或下载失败
**解决方案**:

- 检查浏览器的下载设置
- 减少导出的数据量
- 尝试不同的导出格式

#### 4. 权限不足

**问题**: 提示权限不足或看不到某些数据
**解决方案**:

- 确认用户角色和权限设置
- 联系系统管理员申请相应权限
- 检查是否在正确的权限范围内查询

### 技术支持

如有技术问题请联系：

- **技术支持邮箱**: <support@example.com>
- **帮助文档**: <https://docs.example.com/train-supervisor-bundle>
- **问题反馈**: 通过系统内的反馈功能或GitHub Issues

### 更新日志

#### v1.0.0 (2024-12-01)

- ✅ 新增学习统计模块
- ✅ 支持多维度数据查询
- ✅ 提供实时统计功能
- ✅ 支持数据导出
- ✅ 权限控制和角色管理
